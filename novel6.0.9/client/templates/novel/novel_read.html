<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小说阅读页</title>
</head>

<body>
    <a href="/v1/index">点击回到主页</a><br>
    <div id="read">

    </div>

    <script>
        function createXhr() {
            //判断是否有XMLHttpRequest
            if (window.XMLHttpRequest) {
                var xhr = new XMLHttpRequest();
                console.log(xhr);
            } else {
                var xhr = new ActiveXObjecxt("Microsoft.XMLHTTP");
                console.log(xhr);
            }
            return xhr;
        }
        // dom元素div
        var read = document.getElementById("read");
        var read_code = ``;
        var token = window.localStorage.getItem("my_site_1_token");
        var user = window.localStorage.getItem("my_site_1_user");
        var data1 = {};
        // 小说id/content_id
        var novel_id = window.location.href.split("novel/")[1].split("/")[0];
        var novel_content_id = window.location.href.split("novel/")[1].split("/")[1];
        // console.log(novel_id, novel_content_id);
        data1["token"] = token;
        data1["novel_id"] = novel_id;
        data1["content_id"] = novel_content_id;
        data1 = JSON.stringify(data1);
        // 用ajax提交请求p,根据返回的json内容前端判断登录是否正规,如果不正规前端路径跳转到登录界面
        // 创建xhr对象
        var xhr = createXhr();
        xhr.open("POST", "http://176.215.22.95:8001/v2/novel/read_novel", true);
        // 3.设置回调函数
        xhr.onreadystatechange = function() {
            // 代表xhr对象响应成功,并且服务器端响应正常
            if (xhr.readyState === 4 && xhr.status === 200) {
                console.log(JSON.parse(xhr.responseText));
                // json里数字可以用字符串,也可以直接写数字,这两者是有区别的
                if (JSON.parse(xhr.responseText).code === 403) {
                    read_code = read_code + `vip才能看这本小说,赶紧回主页登录充值<br>`;
                    read.innerHTML = read_code;
                } else if (JSON.parse(xhr.responseText).code != "888" && JSON.parse(xhr.responseText).code != "2000") {
                    read_code = read_code + `没找到资源<br>`;
                    read.innerHTML = read_code;
                }
                if (JSON.parse(xhr.responseText).code === "888") {
                    read_code = read_code + `vip才能看这本小说,赶紧回主页充值<br>`;
                    read.innerHTML = read_code;
                }
                if (JSON.parse(xhr.responseText).code === "2000") {
                    read_code = read_code + novel_content_id + `&nbsp;` + JSON.parse(xhr.responseText).title + `<br>` + JSON.parse(xhr.responseText).content + `<br>` + `<a href="/v1/novel/` + novel_id + `">点击回到目录页</a><br>` + `<a href="/v1/novel/` + novel_id + `/` + (Number(novel_content_id) + 1) + `">下一章</a><br>` + `<a href="/v1/novel/` + novel_id + `/` + (Number(novel_content_id) - 1) + `">上一章</a><br>`;
                    read.innerHTML = read_code;
                }
            }
        };
        // 发送之前设置请求头等..设置发送json格式的内容
        xhr.setRequestHeader('content-type', 'application/json');
        // 4 发送请求
        xhr.send(data1);
    </script>
</body>

</html>