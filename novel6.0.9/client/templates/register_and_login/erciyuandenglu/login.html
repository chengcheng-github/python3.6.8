<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="renderer" content="webkit">
    <title>登录</title>
    <link href="/static/css/bootstrap.min-3.4.0.css" rel="stylesheet">
    <link href="/static/css/font-awesome-4.3.0.css" rel="stylesheet">
    <link href="/static/css/animate.css" rel="stylesheet">
    <link href="/static/css/style-2.2.0.css" rel="stylesheet">
    <link href="/static/css/index.css" rel="stylesheet">
</head>

<body class="gray-bg">
    <div class="middle-box text-center loginscreen  animated fadeInDown">
        <div class="form-signin">
            <div id="stage">
                <div id="inner">
                    <div id="cover">
                        <div id="text">
                            <span style="color: cyan;"></span><span style="color: white;"></span>
                        </div>
                        <div id="detail"></div>
                        <div id="handle"></div>
                    </div>
                    <canvas class="mb-4" id="live2d" width="800" height="800"></canvas>
                </div>
                <a id="info" href="javascript:info()"><i class="fa fa-lg fa-info"></i></a>
                <a id="refresh" href="javascript:refresh()"><i class="fa fa-lg fa-refresh"></i></a>
            </div>
            <h3>欢迎</h3>

            <form class="m-t" role="form" method="post" action="/H/login">
                <div class="form-group">
                    <input name="username" type="phone" class="form-control" placeholder="邮箱" value="" required="" id="mail1">
                </div>
                <div class="form-group">
                    <input name="password" type="password" class="form-control" placeholder="密码" required="" id="pwd1">
                </div>


                <div class="form-group">
                    <div class="checkbox i-checks">
                        <!-- <label class="no-padding"> -->
                        <!-- <input type="checkbox" name="remember"><i></i> 自动登录</label> -->
                        <!-- <span style="padding: 0 10px">|</span> -->
                        <span class="text-muted text-center"><a href="/v1/register_and_login/register">注册一个新账号</a>
                        </span>
                    </div>
                </div>

            </form>
            <button id="btn1">登 录</button>
            <img src="/static/picture/1.gif" style="width: 100%;">
        </div>
    </div>

    <!-- Mainly scripts -->
    <script src="/static/js/jquery-2.1.1.min.js"></script>
    <script src="/static/js/bootstrap.min-3.4.0.js"></script>
    <script type="text/javascript">
        function stop() {
            return false;
        }

        function createXhr() {
            //判断是否有XMLHttpRequest
            if (window.XMLHttpRequest) {
                var xhr = new XMLHttpRequest();
                console.log(xhr);
            } else {
                var xhr = new ActiveXObjecxt("Microsoft.XMLHTTP");
                console.log(xhr);
            }
            return xhr;
        }
        // 用ajax提交请求p,根据返回的json内容前端判断登录是否正规,如果不正规前端路径跳转到登录界面

        document.oncontextmenu = stop;
        var btn1 = document.getElementById("btn1");
        var mail1 = document.getElementById("mail1");
        var pwd1 = document.getElementById("pwd1");
        // 创建xhr对象
        var xhr = createXhr();
        var data1 = {};
        btn1.onclick = function() {
            data1 = null;
            data1 = {};
            data1["mail1"] = mail1.value;
            data1["pwd1"] = pwd1.value;
            // console.log();
            data1 = JSON.stringify(data1);
            xhr.open("POST", "http://127.0.0.1:8000/v2/register_and_login/login", true);
            // 3.设置回调函数
            xhr.onreadystatechange = function() {
                // 代表xhr对象响应成功,并且服务器端响应正常
                if (xhr.readyState === 4 && xhr.status === 200) {
                    // 直接显示返回的字符串
                    // console.log(xhr.responseText);
                    // 将返回的字符串作成json格式显示
                    console.log(JSON.parse(xhr.responseText));
                    // if (JSON.parse(xhr.responseText)["error"] != "没有异常") {
                    //     window.location.href = "/v1/register_and_login/login";
                    // }
                    if (JSON.parse(xhr.responseText)["code"] != "200") {
                        // alert("用户名或密码错误");
                        console.log("用户名或密码错误");
                    } else {
                        // 通过登陆验证之后,把token和用户名(邮箱存到浏览器里,然后跳转url到登陆之后的首页
                        window.localStorage.setItem("my_site_1_user", JSON.parse(xhr.responseText)["my_site_1_user"]);
                        window.localStorage.setItem("my_site_1_token", JSON.parse(xhr.responseText)["data"]["token"]);
                        window.localStorage.setItem("my_site_1_user_mail", JSON.parse(xhr.responseText).user_mail);
                        window.location.href = "/democopy24";
                    }
                }
            };
            // 发送之前设置请求头等..设置发送json格式的内容
            xhr.setRequestHeader('content-type', 'application/json');
            // 4 发送请求
            xhr.send(data1);
        };
    </script>
    <script src="/static/js/live2d.min.js"></script>
    <script src="/static/js/index.js"></script>
</body>

</html>

</html>